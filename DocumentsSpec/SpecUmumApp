# Spesifikasi Teknis: Sistem Informasi Manajemen Pondok Pesantren (eâ€‘Maktab)

## 1. Visi & Tujuan

Membangun platform terintegrasi yang berfungsi sebagai **website publik** dan **sistem manajemen internal (eâ€‘Maktab)** dalam satu aplikasi, dengan satu sumber data terpusat (single source of truth) untuk meningkatkan efisiensi operasional, transparansi, dan pelayanan pondok pesantren.

## 2. Arsitektur & Stack Inti

- **Frontend aktif:** Vite + React + TypeScript, React Router v6.  
- **UI:** Tailwind CSS + komponen custom bertema Islamic Royal (Emerald & Gold).  
- **Backend:** Supabase (PostgreSQL, Auth, Storage).  
- **Konsep:**  
  - Website publik (landing, profil, kontak, PSB publik).  
  - Dashboard eâ€‘Maktab (akses privat setelah login).  

Setiap modul baru harus memiliki relasi ke tabel `profiles` (user) atau `santri` sehingga setiap aktivitas dapat ditelusuri ke pengguna atau santri tertentu.

***

## 3. Identitas Visual & Design System

- **Tema:** Islamic Royal / Islamic Modern Futuristic.  
- **Karakteristik:**  
  - Background login: emerald gelap (`emerald-950`) dengan elemen blur dekoratif.  
  - Card: glassmorphism (`backdrop-blur`, transparansi lembut), border emas/amber untuk elemen penting.  
  - Dashboard: gradasi lembut (misalnya `from-slate-50` ke `to-slate-100`) dengan kartu modul berwarna.  
- **Typography:**  
  - Heading: serif elegan (misal Playfair Display).  
  - Body: sans-serif modern (misal Inter).  
- **Komponen reusable:**  
  - `Button`, `Card`, `Badge`, `Dialog/Modal`, `Input`, `Form`, `Table`, `Alert`.  
- **Responsiveness:**  
  - Login: split-screen di desktop (branding + form), stack di mobile.  
  - Dashboard: sidebar selalu ada, konten menyesuaikan layar, grid modul responsif.

***

## 4. Auth & Permission Engine

### 4.1. Supabase Auth di Vite

- **Client:** `src/lib/supabaseClient.ts`  
  - Menggunakan `@supabase/supabase-js`.  
  - Membaca env:
    - `VITE_SUPABASE_URL`  
    - `VITE_SUPABASE_ANON_KEY`  
  - Session dipertahankan di `localStorage`.  

- **Hook Auth:** `src/hooks/useAuth.ts`  
  Menyediakan:  
  - `signIn(email, password)`  
  - `signOut()`  
  - `getSession()`  
  - Listener realâ€‘time auth state (login/logout).  
  - Autoâ€‘fetch `profile` dari tabel `profiles` (join ke `roles` bila ada).

### 4.2. Skema Database Auth & Role

Ringkasan tabel (disesuaikan dengan yang sudah ada):

- **`profiles`**  
  - `id` (uuid, pk = `auth.users.id`)  
  - `full_name` (text)  
  - `role_id` (uuid, fk â†’ `roles`)  
  - `is_active` (boolean)  

- **`roles`**  
  - `id` (uuid, pk)  
  - `name` (text, unik, misal: `Superadmin`, `Operator PSB`)  
  - `slug` (text, unik, misal: `superadmin`, `operator_psb`)  

- **`permissions`**  
  - `id` (uuid, pk)  
  - `slug` (text, unik, misal `module.psb`, `module.santri`, `module.users`)  
  - `description` (text)  

- **`user_permissions`** / `role_permissions`  
  - `id` (uuid, pk)  
  - `user_id` atau `role_id` (fk)  
  - `permission_id` (fk â†’ `permissions`)  

Pada fase awal, sistem bisa memakai `role_id` sederhana untuk mengatur akses menu; detail perâ€‘permission dapat diaktifkan bertahap.

### 4.3. Protected Routes

- **`src/components/ProtectedRoute.tsx`**  
  - Menggunakan `<Outlet />` (React Router).  
  - Saat mount:
    - Cek session melalui `useAuth()`.  
    - Jika tidak ada session â†’ redirect ke `/login`.  
  - Membungkus rute: `/dashboard`, `/users`, dan rute eâ€‘Maktab lainnya.

***

## 5. Struktur Menu Dashboard eâ€‘Maktab (Sidebar)

Sidebar ditampilkan setelah login di seluruh halaman dashboard. Struktur yang akan dibangun:

```text
ğŸ  Dashboard
---
ğŸ“ Manajemen Website          <-- [AKTIF]
â”‚   â””â”€â”€ Halaman Statis
---
ğŸ“‹ Pendaftaran (PSB)          <-- [AKTIF]
â”‚   â”œâ”€â”€ Data Pendaftar
â”‚   â”œâ”€â”€ Pembayaran            <-- [AKTIF]
â”‚   â””â”€â”€ Kategori & Persyaratan
---
ğŸ‘¥ Master Data                <-- [AKTIF]
â”‚   â””â”€â”€ Santri
---
ğŸ’° Keuangan                   <-- [COMING SOON]
ğŸ“š Akademik                   <-- [COMING SOON]
ğŸ“¦ Inventaris                 <-- [COMING SOON]
ğŸ›’ Koperasi                   <-- [COMING SOON]
(icon) Manajemen User         <-- [COMING SOON]
---
âš™ï¸ Pengaturan
    â””â”€â”€ Profil Saya
```

- **[AKTIF]:**  
  - Link normal, dapat diklik, menampilkan halaman terkait.  
- **[COMING SOON]:**  
  - Ikon + teks abuâ€‘abu (opacity lebih rendah).  
  - Tidak dapat diklik (tidak ada navigasi).  
  - Tooltip: â€œFitur ini sedang dalam tahap pengembangan.â€  

Secara teknis, status `[AKTIF]/[COMING SOON]` bisa direpresentasikan sebagai field `status` pada konfigurasi menu di frontend, dan di kemudian hari bisa digabungkan dengan `role`/`permission` untuk kontrol akses yang lebih halus.

***

## 6. Modulâ€‘modul Aktif pada Fase Awal

### 6.1. Dashboard Utama (`/dashboard`)

- **Header:**  
  - Logo eâ€‘Maktab, judul aplikasi.  
  - Informasi user login (nama, role).  
  - Tombol Logout.  

- **Konten:**  
  - Greeting: â€œSelamat datang, {nama}â€.  
  - Kartu statistik ringkas (placeholder):
    - Total Santri.  
    - Pendaftar Baru.  
    - Pengguna Aktif.  
  - Grid tautan cepat ke modul:
    - Manajemen Website.  
    - Pendaftaran (PSB).  
    - Master Data Santri.  

### 6.2. Manajemen Website (`/dashboard/website-management`)

- Submenu: **Halaman Statis**.  
- Fitur:  
  - Tabel daftar halaman (slug, title).  
  - CRUD untuk `title` dan `content` (Profil, Kontak, dsb.).  
- Data diambil dari tabel `website_pages` (atau setara).

### 6.3. Pendaftaran (PSB) (`/dashboard/psb`)

Submenu:

1. **Data Pendaftar**  
   - Tabel calon santri (`psb_pendaftar`): nama, kategori, status PSB, status pembayaran.  
   - Filter berdasarkan status (`baru`, `diproses`, `diterima`, `ditolak`) dan status pembayaran (`belum_bayar`, `menunggu_verifikasi`, `lunas`, `gagal`).  
   - Detail pendaftar: data pribadi, dokumen upload, histori pembayaran, aksi â€œTerima / Tolakâ€.  

2. **Pembayaran**  
   - Tabel `psb_pembayaran`: nomor pendaftar, nama, jenis pembayaran, nominal, metode, tanggal, status verifikasi.  
   - Filter: `status_verifikasi` (`menunggu`, `diterima`, `ditolak`).  
   - Halaman detail:
     - Preview bukti pembayaran dari Supabase Storage.  
     - Aksi:
       - â€œTerima Pembayaranâ€ â†’ set status verifikasi `diterima`, update `status_pembayaran = 'lunas'` di `psb_pendaftar`.  
       - â€œTolak Pembayaranâ€ â†’ set `ditolak`, wajib isi catatan admin, opsional ubah `status_pembayaran = 'gagal'`.  

3. **Kategori & Persyaratan**  
   - Manajemen `kategori_santri` (Reguler, Beasiswa, dsb.).  
   - Manajemen `master_dokumen` dan pivot `kategori_dokumen_pivot` (kategori â†” jenis dokumen).  

### 6.4. Master Data (`/dashboard/master-data`)

Submenu:

- **Santri**  
  - Tabel `santri`: NIS, nama, status_santri.  
  - Data dibuat ketika admin menerima pendaftar PSB (input NIS, insert ke `santri`, link ke `psb_pendaftar_id`).  

***

## 7. Modul Coming Soon

Ditampilkan di sidebar dengan status `[COMING SOON]`:

- **Keuangan:** modul pengelolaan keuangan santri (SPP, tabungan, pembayaran lain).  
- **Akademik:** modul nilai, jadwal, kelas, dan rapor.  
- **Inventaris:** modul aset dan sarana prasarana.  
- **Koperasi:** modul transaksi koperasi pesantren.  
- **Manajemen User:** modul lanjutan untuk kelola user dan role dari UI (saat ini baru ada halaman Users readâ€‘only).  

Pada fase sekarang, modulâ€‘modul ini tidak memiliki halaman aktif; hanya placeholder di sidebar.

***

## 8. Website Publik (Ringkas)

- **Landing Page:**  
  - Branding eâ€‘Maktab, informasi singkat pondok, CTA login.  
- **Profil & Kontak:**  
  - Konten bisa berasal dari `website_pages` atau statis sementara.  
- **Form PSB Publik (Fase berikut):**  
  - `/psb/daftar`: pilih kategori â†’ isi form â†’ upload dokumen.  
  - Halaman status/konfirmasi pembayaran untuk upload bukti transfer.

***

## 9. Catatan Implementasi & Praktik Baik

- Gunakan type hasil generate Supabase untuk TypeScript, disimpan di `lib/supabase/types.ts`.  
- Validasi form penting dengan React Hook Form + Zod (atau validator sejenis).  
- Untuk file upload (dokumen PSB, bukti pembayaran), simpan hanya path di database; file disimpan di Supabase Storage.  
- Jaga konsistensi desain dengan memusatkan style di komponen reusable dan Tailwind config (palet emerald & gold).  
- Setiap perubahan besar pada struktur menu, modul, atau skema database harus tercermin di file spesifikasi ini agar tetap menjadi acuan utama pengembangan.

***

Spesifikasi ini bisa disimpan sebagai `SPEC-eMaktab-v1.2.md` di repo Anda dan dijadikan referensi tunggal untuk semua pengembangan eâ€‘Maktab ke depan.