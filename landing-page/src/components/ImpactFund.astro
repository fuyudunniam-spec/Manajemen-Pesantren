---
interface Props {
  title?: string;
  description?: string;
  auditReportLink?: string;
  allocationStats?: {
    label: string;
    percentage: number;
    color: string;
  }[];
  scholarshipStats?: {
    count: string;
    label: string;
    description: string;
  };
  umkmStats?: {
    count: string;
    label: string;
    description: string;
  };
  economicGraph?: string;
}

const {
  title = "Transparansi Dana",
  description = "Kami mengelola dana amanah Anda dengan standar akuntansi profesional. Setiap Rupiah yang Anda investasikan tercatat dan terukur dampaknya.",
  auditReportLink,
  allocationStats = [
    { label: "Pendidikan (Beasiswa)", percentage: 45, color: "#1e293b" }, // dark slate
    { label: "Pemberdayaan Ekonomi", percentage: 30, color: "#ca8a04" }, // yellow-600
    { label: "Infrastruktur", percentage: 15, color: "#64748b" }, // slate-500
    { label: "Operasional", percentage: 10, color: "#e2e8f0" }  // slate-200
  ],
  scholarshipStats = {
    count: "450+",
    label: "Santri Yatim & Dhuafa",
    description: "mendapatkan akses pendidikan formal dan diniyah kualitas premium (Setara Boarding School)."
  },
  umkmStats = {
    count: "85 UMKM",
    label: "Unit Usaha Mikro",
    description: "yang dirintis oleh alumni dan wali santri melalui program modal bergulir tanpa riba."
  },
  economicGraph
} = Astro.props;

// Calculate conic gradient string
let currentAngle = 0;
const safeStats = allocationStats || [];
const gradientParts = safeStats.map(stat => {
    const start = currentAngle;
    const end = currentAngle + (stat.percentage * 3.6);
    currentAngle = end;
    return `${stat.color} ${start}deg ${end}deg`;
});
const conicGradient = gradientParts.length > 0 ? `conic-gradient(${gradientParts.join(', ')})` : 'transparent';
---

<section id="impact-fund" class="py-20 bg-gray-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    
    <!-- Header -->
    <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-16 gap-6">
      <div class="max-w-2xl">
        <h2 class="font-serif text-4xl md:text-5xl font-bold text-primary mb-6">{title}</h2>
        <p class="text-lg text-gray-600 leading-relaxed font-sans">
          {description}
        </p>
      </div>
      {auditReportLink && (
        <a href={auditReportLink} target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 text-secondary font-medium hover:text-secondary/80 transition-colors">
          <span>Audit Eksternal 2023</span>
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
        </a>
      )}
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
      
      <!-- Allocation Chart -->
      <div class="bg-white rounded-3xl p-8 shadow-sm lg:col-span-4 border border-gray-100">
        <h3 class="font-serif text-xl font-bold text-primary mb-8">Alokasi Dana Wakaf</h3>
        
        <div class="flex flex-col items-center">
            <!-- Donut Chart -->
            <div class="relative w-64 h-64 rounded-full mb-8" style={`background: ${conicGradient}`}>
                <div class="absolute inset-0 m-auto w-32 h-32 bg-white rounded-full flex items-center justify-center shadow-inner">
                   <div class="text-center">
                       <span class="block text-2xl font-bold text-primary">100%</span>
                       <span class="text-xs text-gray-500 uppercase tracking-wider">Amanah</span>
                   </div>
                </div>
            </div>

            <!-- Legend -->
            <div class="grid grid-cols-2 gap-x-4 gap-y-3 w-full">
                {safeStats.map(stat => (
                    <div class="flex items-center gap-2">
                        <span class="w-3 h-3 rounded-full flex-shrink-0" style={`background-color: ${stat.color}`}></span>
                        <span class="text-xs text-gray-600">{stat.label}</span>
                    </div>
                ))}
            </div>
             <p class="mt-8 text-[10px] text-gray-400 text-center">*Data per Q1 2024. Diaudit oleh KAP Terdaftar.</p>
        </div>
      </div>

      <!-- Impact Stats -->
      <div class="lg:col-span-8 space-y-8">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            
            <!-- Education Stats -->
            <div class="bg-primary rounded-3xl p-8 text-white relative overflow-hidden group">
                 <div class="relative z-10">
                    <span class="text-secondary text-xs font-bold uppercase tracking-widest mb-2 block">Beasiswa Pendidikan</span>
                    <div class="text-5xl font-serif font-bold mb-4">{scholarshipStats?.count || '0'}</div>
                    <h4 class="text-lg font-medium mb-2">{scholarshipStats?.label || 'Target Santri'}</h4>
                    <p class="text-white/70 text-sm leading-relaxed border-t border-white/10 pt-4 mt-4">
                        {scholarshipStats?.description || 'Data sedang diperbarui.'}
                    </p>
                 </div>
                 <!-- Icon Background -->
                 <svg class="absolute bottom-4 right-4 w-32 h-32 text-white/5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 3L1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82z"/></svg>
            </div>

             <!-- UMKM Stats -->
            <div class="bg-white rounded-3xl p-8 border border-gray-100 shadow-sm relative overflow-hidden group">
                 <div class="relative z-10">
                      <div class="w-10 h-10 bg-green-50 rounded-lg flex items-center justify-center mb-4 text-green-600">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 22h20"/><path d="M12 2v20"/><path d="m2 10 10-6 10 6"/><path d="m5 16 7-6 7 6"/></svg>
                      </div>
                      <div class="text-[10px] bg-gray-100 px-2 py-1 rounded inline-block text-gray-500 font-medium mb-2 uppercase tracking-wide float-right">ROI Sosial Tinggi</div>
                    <div class="text-4xl font-serif font-bold text-primary mb-2 clear-both">{umkmStats?.count || '0'}</div>
                    <p class="text-gray-600 text-sm leading-relaxed">
                        {umkmStats?.description || 'Data sedang diperbarui.'}
                    </p>
                 </div>
            </div>
        </div>

        <!-- Economic Graph -->
        <div class="bg-[#FFFDF5] rounded-3xl p-8 border border-yellow-100/50">
             <div class="flex flex-col md:flex-row gap-8 items-center">
                 <div class="flex-1">
                     <h3 class="font-serif text-xl font-bold text-primary mb-2">Transformasi Ekonomi Keluarga</h3>
                     <p class="text-sm text-gray-600 mb-6">Grafik peningkatan pendapatan rata-rata keluarga santri setelah 3 tahun intervensi program kemandirian.</p>
                 </div>
                 <div class="flex-1 w-full relative h-[150px]">
                    {economicGraph ? (
                        <img src={economicGraph} alt="Economic Growth Graph" class="w-full h-full object-contain" />
                    ) : (
                        // Placeholder SVG Simple Line Chart
                        <svg viewBox="0 0 400 150" class="w-full h-full text-secondary">
                            <defs>
                                <linearGradient id="gradient" x1="0" y1="0" x2="0" y2="1">
                                    <stop offset="0%" stop-color="currentColor" stop-opacity="0.2"/>
                                    <stop offset="100%" stop-color="currentColor" stop-opacity="0"/>
                                </linearGradient>
                            </defs>
                            <path d="M0,150 L0,120 Q100,110 200,80 T400,20 V150 Z" fill="url(#gradient)" />
                            <path d="M0,120 Q100,110 200,80 T400,20" fill="none" stroke="currentColor" stroke-width="3" />
                            <circle cx="0" cy="120" r="4" fill="currentColor" />
                            <circle cx="200" cy="80" r="4" fill="currentColor" />
                            <circle cx="400" cy="20" r="4" fill="currentColor" />
                            <text x="10" y="140" font-size="10" fill="#94a3b8">Tahun 0</text>
                            <text x="200" y="100" font-size="10" fill="#94a3b8">Tahun 1</text>
                            <text x="350" y="40" font-size="10" fill="#94a3b8">Tahun 3</text>
                        </svg>
                    )}
                 </div>
             </div>
        </div>

      </div>

    </div>
  </div>
</section>
