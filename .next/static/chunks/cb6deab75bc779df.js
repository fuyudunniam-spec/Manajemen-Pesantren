(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,19455,20783,91918,25913,e=>{"use strict";var t=e.i(43476),a=e.i(71645);function r(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function s(...e){return t=>{let a=!1,s=e.map(e=>{let s=r(e,t);return a||"function"!=typeof s||(a=!0),s});if(a)return()=>{for(let t=0;t<s.length;t++){let a=s[t];"function"==typeof a?a():r(e[t],null)}}}}function l(...e){return a.useCallback(s(...e),e)}function n(e){var r;let l,n=(r=e,(l=a.forwardRef((e,t)=>{let{children:r,...l}=e;if(a.isValidElement(r)){var n;let e,i,o=(n=r,(i=(e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?n.ref:(i=(e=Object.getOwnPropertyDescriptor(n,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?n.props.ref:n.props.ref||n.ref),d=function(e,t){let a={...t};for(let r in t){let s=e[r],l=t[r];/^on[A-Z]/.test(r)?s&&l?a[r]=(...e)=>{let t=l(...e);return s(...e),t}:s&&(a[r]=s):"style"===r?a[r]={...s,...l}:"className"===r&&(a[r]=[s,l].filter(Boolean).join(" "))}return{...e,...a}}(l,r.props);return r.type!==a.Fragment&&(d.ref=t?s(t,o):o),a.cloneElement(r,d)}return a.Children.count(r)>1?a.Children.only(null):null})).displayName=`${r}.SlotClone`,l),i=a.forwardRef((e,r)=>{let{children:s,...l}=e,i=a.Children.toArray(s),o=i.find(c);if(o){let e=o.props.children,s=i.map(t=>t!==o?t:a.Children.count(e)>1?a.Children.only(null):a.isValidElement(e)?e.props.children:null);return(0,t.jsx)(n,{...l,ref:r,children:a.isValidElement(e)?a.cloneElement(e,void 0,s):null})}return(0,t.jsx)(n,{...l,ref:r,children:s})});return i.displayName=`${e}.Slot`,i}e.s(["composeRefs",()=>s,"useComposedRefs",()=>l],20783);var i=n("Slot"),o=Symbol("radix.slottable");function d(e){let a=({children:e})=>(0,t.jsx)(t.Fragment,{children:e});return a.displayName=`${e}.Slottable`,a.__radixId=o,a}function c(e){return a.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===o}e.s(["Slot",()=>i,"createSlot",()=>n,"createSlottable",()=>d],91918);var u=e.i(7670);let m=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,x=u.clsx,h=(e,t)=>a=>{var r;if((null==t?void 0:t.variants)==null)return x(e,null==a?void 0:a.class,null==a?void 0:a.className);let{variants:s,defaultVariants:l}=t,n=Object.keys(s).map(e=>{let t=null==a?void 0:a[e],r=null==l?void 0:l[e];if(null===t)return null;let n=m(t)||m(r);return s[e][n]}),i=a&&Object.entries(a).reduce((e,t)=>{let[a,r]=t;return void 0===r||(e[a]=r),e},{});return x(e,n,null==t||null==(r=t.compoundVariants)?void 0:r.reduce((e,t)=>{let{class:a,className:r,...s}=t;return Object.entries(s).every(e=>{let[t,a]=e;return Array.isArray(a)?a.includes({...l,...i}[t]):({...l,...i})[t]===a})?[...e,a,r]:e},[]),null==a?void 0:a.class,null==a?void 0:a.className)};e.s(["cva",0,h],25913);var p=e.i(75157);let f=h("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium ring-offset-background transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-soft hover:shadow-card",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border-2 border-primary bg-transparent text-primary hover:bg-primary hover:text-primary-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 shadow-soft",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",hero:"bg-secondary text-secondary-foreground hover:bg-secondary/90 shadow-elevated hover:shadow-card font-semibold","hero-outline":"border-2 border-primary-foreground/30 bg-transparent text-primary-foreground hover:bg-primary-foreground/10 backdrop-blur-sm",gold:"bg-gradient-to-r from-secondary to-amber-500 text-secondary-foreground hover:from-secondary/90 hover:to-amber-500/90 shadow-card font-semibold"},size:{default:"h-10 px-5 py-2",sm:"h-9 rounded-md px-3",lg:"h-12 rounded-lg px-8 text-base",xl:"h-14 rounded-xl px-10 text-lg",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),g=a.forwardRef(({className:e,variant:a,size:r,asChild:s=!1,...l},n)=>(0,t.jsx)(s?i:"button",{className:(0,p.cn)(f({variant:a,size:r,className:e})),ref:n,...l}));g.displayName="Button",e.s(["Button",()=>g,"buttonVariants",()=>f],19455)},37727,e=>{"use strict";let t=(0,e.i(75254).default)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);e.s(["X",()=>t],37727)},93479,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(75157);let s=a.forwardRef(({className:e,type:a,...s},l)=>(0,t.jsx)("input",{type:a,className:(0,r.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:l,...s}));s.displayName="Input",e.s(["Input",()=>s])},15288,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(75157);let s=a.forwardRef(({className:e,...a},s)=>(0,t.jsx)("div",{ref:s,className:(0,r.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...a}));s.displayName="Card";let l=a.forwardRef(({className:e,...a},s)=>(0,t.jsx)("div",{ref:s,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",e),...a}));l.displayName="CardHeader";let n=a.forwardRef(({className:e,...a},s)=>(0,t.jsx)("h3",{ref:s,className:(0,r.cn)("text-2xl font-semibold leading-none tracking-tight",e),...a}));n.displayName="CardTitle";let i=a.forwardRef(({className:e,...a},s)=>(0,t.jsx)("p",{ref:s,className:(0,r.cn)("text-sm text-muted-foreground",e),...a}));i.displayName="CardDescription";let o=a.forwardRef(({className:e,...a},s)=>(0,t.jsx)("div",{ref:s,className:(0,r.cn)("p-6 pt-0",e),...a}));o.displayName="CardContent",a.forwardRef(({className:e,...a},s)=>(0,t.jsx)("div",{ref:s,className:(0,r.cn)("flex items-center p-6 pt-0",e),...a})).displayName="CardFooter",e.s(["Card",()=>s,"CardContent",()=>o,"CardDescription",()=>i,"CardHeader",()=>l,"CardTitle",()=>n])},79002,e=>{"use strict";let t=(0,e.i(75254).default)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);e.s(["UserPlus",()=>t],79002)},56272,52044,e=>{"use strict";var t=e.i(75254);let a=(0,t.default)("SquareCheckBig",[["path",{d:"M21 10.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.5",key:"1uzm8b"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckSquare",()=>a],56272);let r=(0,t.default)("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);e.s(["Square",()=>r],52044)},27612,e=>{"use strict";let t=(0,e.i(75254).default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);e.s(["Trash2",()=>t],27612)},88511,e=>{"use strict";let t=(0,e.i(75254).default)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);e.s(["Edit",()=>t],88511)},97548,e=>{"use strict";let t=(0,e.i(75254).default)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);e.s(["Filter",()=>t],97548)},98134,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(11795),s=e.i(15288),l=e.i(19455),n=e.i(79002),i=e.i(55436),o=e.i(97548),d=e.i(75254);let c=(0,d.default)("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),u=(0,d.default)("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);var m=e.i(88511);let x=(0,d.default)("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]),h=(0,d.default)("PowerOff",[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);var p=e.i(27612),f=e.i(18566),g=e.i(93479),b=e.i(37727);function y({roles:e,onClose:n,onSuccess:i}){let[o,d]=(0,a.useState)(!1),[c,u]=(0,a.useState)(null),[m,x]=(0,a.useState)(e||[]),[h,p]=(0,a.useState)(!1);(0,f.useRouter)();let y=(0,r.createClient)();async function v(e){e.preventDefault(),d(!0),u(null);let t=new FormData(e.currentTarget),a=t.get("email")?.trim().toLowerCase(),r=t.get("password"),s=t.get("fullName")?.trim(),l=t.get("roleId");if(!a||!a.includes("@")){u("Email tidak valid. Pastikan format email benar (contoh: user@example.com)"),d(!1);return}if(!r||r.length<6){u("Password minimal 6 karakter"),d(!1);return}if(!s||s.length<2){u("Nama lengkap minimal 2 karakter"),d(!1);return}if(!l){u("Silakan pilih role untuk user ini."),d(!1);return}try{let{data:e,error:t}=await y.auth.signUp({email:a,password:r,options:{data:{full_name:s},emailRedirectTo:void 0}});if(t){console.error("Auth Error:",t),t.message.includes("invalid")||t.message.includes("Email address")?u("Format email tidak valid. Pastikan email menggunakan format yang benar (contoh: user@example.com)"):t.message.includes("already registered")||t.message.includes("already exists")?u("Email ini sudah terdaftar. Gunakan email lain."):t.message.includes("password")?u("Password tidak memenuhi syarat. Minimal 6 karakter."):u(t.message||"Gagal membuat user. Silakan coba lagi."),d(!1);return}if(e.user){let{error:t}=await y.from("profiles").insert({id:e.user.id,full_name:s,role_id:l,is_active:!0});if(t){console.error("Profile Error:",t),u("Gagal membuat profil: "+t.message),d(!1);return}i(),n()}else u("Gagal membuat user. User mungkin perlu konfirmasi email terlebih dahulu."),d(!1)}catch(e){console.error("Exception in handleSubmit:",e),u(e.message||"Terjadi kesalahan. Silakan coba lagi."),d(!1)}}return(0,a.useEffect)(()=>{!async function(){if(e&&0!==e.length)x(e);else{p(!0);try{let{data:e,error:t}=await y.from("roles").select("id, name, slug, description").order("created_at",{ascending:!0});t?(console.error("Error fetching roles in modal:",t),u("Gagal memuat daftar role. Silakan refresh halaman."),x([])):(console.log("Roles loaded in modal:",e),x(e||[]),u(null))}catch(e){console.error("Exception fetching roles:",e),u("Terjadi kesalahan saat memuat role."),x([])}finally{p(!1)}}}()},[]),(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm",children:(0,t.jsxs)(s.Card,{className:"w-full max-w-lg glass-card relative overflow-hidden border-slate-200/80 shadow-xl",children:[(0,t.jsx)("button",{onClick:n,className:"absolute top-4 right-4 z-10 text-slate-500 hover:text-slate-700 transition-colors",children:(0,t.jsx)(b.X,{className:"w-5 h-5"})}),(0,t.jsxs)(s.CardHeader,{className:"bg-gradient-to-r from-emerald-600 to-emerald-700 text-white",children:[(0,t.jsx)("h2",{className:"text-xl font-display font-bold",children:"Tambah User Baru"}),(0,t.jsx)("p",{className:"text-emerald-50 text-xs mt-1",children:"Daftarkan personil baru ke sistem e-Maktab"})]}),(0,t.jsx)(s.CardContent,{className:"bg-white",children:(0,t.jsxs)("form",{onSubmit:v,className:"space-y-5",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-xs font-semibold text-slate-700 uppercase tracking-wide",children:"Nama Lengkap"}),(0,t.jsx)(g.Input,{name:"fullName",placeholder:"Contoh: Ahmad Fauzan",required:!0,className:"bg-white border-slate-300 text-slate-900 placeholder:text-slate-400 focus:border-emerald-600 focus:ring-emerald-600/20"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-xs font-semibold text-slate-700 uppercase tracking-wide",children:"Email"}),(0,t.jsx)(g.Input,{name:"email",type:"email",placeholder:"email@example.com",required:!0,className:"bg-white border-slate-300 text-slate-900 placeholder:text-slate-400 focus:border-emerald-600 focus:ring-emerald-600/20"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-xs font-semibold text-slate-700 uppercase tracking-wide",children:"Role"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsxs)("select",{name:"roleId",className:"w-full h-11 bg-white border border-slate-300 rounded-lg px-4 pr-10 text-sm text-slate-900 focus:outline-none focus:border-emerald-600 focus:ring-2 focus:ring-emerald-600/20 appearance-none cursor-pointer shadow-sm disabled:opacity-50 disabled:cursor-not-allowed",required:!0,disabled:h,children:[(0,t.jsx)("option",{value:"",className:"text-slate-500",children:h?"Memuat role...":"Pilih Role"}),m&&m.length>0?m.map(e=>(0,t.jsx)("option",{value:e.id,className:"text-slate-900",children:e.name},e.id)):!h&&(0,t.jsx)("option",{value:"",disabled:!0,className:"text-slate-500",children:"Tidak ada role tersedia"})]}),(0,t.jsx)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-slate-500",children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,t.jsx)("path",{d:"m6 9 6 6 6-6"})})})]}),h&&(0,t.jsxs)("p",{className:"text-xs text-amber-600 mt-1 flex items-center gap-1",children:[(0,t.jsx)("span",{className:"animate-spin inline-block w-3 h-3 border border-amber-600 border-t-transparent rounded-full"}),"Memuat daftar role..."]}),!h&&(!m||0===m.length)&&(0,t.jsx)("p",{className:"text-xs text-red-600 mt-1",children:"⚠️ Tidak ada role tersedia. Pastikan RLS policy sudah dikonfigurasi."})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-xs font-semibold text-slate-700 uppercase tracking-wide",children:"Password"}),(0,t.jsx)(g.Input,{name:"password",type:"password",placeholder:"••••••••",required:!0,minLength:6,className:"bg-white border-slate-300 text-slate-900 placeholder:text-slate-400 focus:border-emerald-600 focus:ring-emerald-600/20"})]})]}),c&&(0,t.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:c}),(0,t.jsxs)("div",{className:"flex justify-end gap-3 pt-6 border-t border-slate-200",children:[(0,t.jsx)(l.Button,{type:"button",variant:"ghost",onClick:n,className:"text-slate-700 hover:text-slate-900 hover:bg-slate-100",children:"Batal"}),(0,t.jsx)(l.Button,{type:"submit",variant:"gold",disabled:o||h||!m||0===m.length,children:o?"Menyimpan...":"Simpan User"})]})]})})]})})}function v({user:e,roles:n,onClose:i,onSuccess:o}){let[d,c]=(0,a.useState)(!1),[u,m]=(0,a.useState)(null),[x,h]=(0,a.useState)(n||[]),p=(0,r.createClient)();async function f(t){t.preventDefault(),c(!0),m(null);let a=new FormData(t.currentTarget),r=a.get("fullName")?.trim(),s=a.get("roleId");if(!r||r.length<2){m("Nama lengkap minimal 2 karakter"),c(!1);return}if(!s){m("Silakan pilih role untuk user ini."),c(!1);return}try{let{error:t}=await p.from("profiles").update({full_name:r,role_id:s,updated_at:new Date().toISOString()}).eq("id",e.id);if(t){console.error("Update Error:",t),m("Gagal mengupdate user: "+t.message),c(!1);return}o(),i()}catch(e){console.error("Exception in handleSubmit:",e),m(e.message||"Terjadi kesalahan. Silakan coba lagi."),c(!1)}}return(0,a.useEffect)(()=>{n&&n.length>0&&h(n)},[n]),(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm",children:(0,t.jsxs)(s.Card,{className:"w-full max-w-lg glass-card relative overflow-hidden border-slate-200/80 shadow-xl",children:[(0,t.jsx)("button",{onClick:i,className:"absolute top-4 right-4 z-10 text-slate-500 hover:text-slate-700 transition-colors",children:(0,t.jsx)(b.X,{className:"w-5 h-5"})}),(0,t.jsxs)(s.CardHeader,{className:"bg-gradient-to-r from-emerald-600 to-emerald-700 text-white",children:[(0,t.jsx)("h2",{className:"text-xl font-display font-bold",children:"Edit User"}),(0,t.jsxs)("p",{className:"text-emerald-50 text-xs mt-1",children:["Ubah informasi user ",e?.full_name||""]})]}),(0,t.jsx)(s.CardContent,{className:"bg-white",children:(0,t.jsxs)("form",{onSubmit:f,className:"space-y-5",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-xs font-semibold text-slate-700 uppercase tracking-wide",children:"Nama Lengkap"}),(0,t.jsx)(g.Input,{name:"fullName",defaultValue:e?.full_name||"",placeholder:"Contoh: Ahmad Fauzan",required:!0,className:"bg-white border-slate-300 text-slate-900 placeholder:text-slate-400 focus:border-emerald-600 focus:ring-emerald-600/20"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-xs font-semibold text-slate-700 uppercase tracking-wide",children:"Role"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsxs)("select",{name:"roleId",defaultValue:e?.role_id||"",className:"w-full h-11 bg-white border border-slate-300 rounded-lg px-4 pr-10 text-sm text-slate-900 focus:outline-none focus:border-emerald-600 focus:ring-2 focus:ring-emerald-600/20 appearance-none cursor-pointer shadow-sm",required:!0,children:[(0,t.jsx)("option",{value:"",className:"text-slate-500",children:"Pilih Role"}),x&&x.length>0?x.map(e=>(0,t.jsx)("option",{value:e.id,className:"text-slate-900",children:e.name},e.id)):(0,t.jsx)("option",{value:"",disabled:!0,className:"text-slate-500",children:"Tidak ada role tersedia"})]}),(0,t.jsx)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-slate-500",children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,t.jsx)("path",{d:"m6 9 6 6 6-6"})})})]})]}),u&&(0,t.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:u}),(0,t.jsxs)("div",{className:"flex justify-end gap-3 pt-6 border-t border-slate-200",children:[(0,t.jsx)(l.Button,{type:"button",variant:"ghost",onClick:i,className:"text-slate-700 hover:text-slate-900 hover:bg-slate-100",children:"Batal"}),(0,t.jsx)(l.Button,{type:"submit",variant:"gold",disabled:d,children:d?"Menyimpan...":"Simpan Perubahan"})]})]})})]})})}var j=e.i(56272),N=e.i(52044),w=e.i(75157);let k=[{slug:"keuangan",name:"Keuangan",description:"Tabungan, SPP, & Pembayaran"},{slug:"akademik",name:"Akademik",description:"Kurikulum & Data Nilai"},{slug:"donasi",name:"Donasi",description:"Manajemen Donatur & Infaq"},{slug:"inventory",name:"Inventory",description:"Aset & Inventaris Pondok"},{slug:"kesehatan",name:"Kesehatan",description:"Catatan Medis Santri"}];function C({user:e,onClose:n,onSuccess:i}){let[o,d]=(0,a.useState)([]),[c,u]=(0,a.useState)(!0),[m,x]=(0,a.useState)(!1),h=(0,r.createClient)();(0,a.useEffect)(()=>{e&&async function(){u(!0);let{data:t}=await h.from("user_permissions").select("permissions(slug)").eq("user_id",e.id);t?d(t.map(e=>e.permissions.slug)):d([]),u(!1)}()},[e]);let p=async()=>{if(!e)return;x(!0),await h.from("user_permissions").delete().eq("user_id",e.id);let{data:t}=await h.from("permissions").select("id, slug").in("slug",o);if(t&&t.length>0){let a=t.map(t=>({user_id:e.id,permission_id:t.id}));await h.from("user_permissions").insert(a)}x(!1),i(),n()};return(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm",children:(0,t.jsxs)(s.Card,{className:"w-full max-w-2xl glass-card relative overflow-hidden flex flex-col max-h-[90vh] border-slate-200/80 shadow-xl",children:[(0,t.jsx)("button",{onClick:n,className:"absolute top-4 right-4 z-10 text-slate-500 hover:text-slate-700 transition-colors",children:(0,t.jsx)(b.X,{className:"w-5 h-5"})}),(0,t.jsxs)(s.CardHeader,{className:"bg-gradient-to-r from-emerald-600 to-emerald-700 text-white",children:[(0,t.jsx)("h2",{className:"text-xl font-display font-bold",children:"Atur Hak Akses"}),(0,t.jsxs)("p",{className:"text-emerald-50 text-xs mt-1",children:["Kelola akses modul untuk ",e?.full_name||"User"]})]}),(0,t.jsx)(s.CardContent,{className:"overflow-y-auto flex-1 bg-white",children:c?(0,t.jsx)("div",{className:"flex items-center justify-center py-10",children:(0,t.jsx)("div",{className:"animate-spin w-6 h-6 border-2 border-emerald-600 border-t-transparent rounded-full"})}):(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:k.map(e=>{let a=o.includes(e.slug);return(0,t.jsxs)("button",{onClick:()=>{var t;return t=e.slug,void d(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},className:(0,w.cn)("flex items-start gap-3 p-4 rounded-lg border-2 transition-all text-left group shadow-sm",a?"bg-amber-50 border-amber-300 text-slate-900 hover:bg-amber-100":"bg-white border-slate-200 text-slate-700 hover:border-slate-300 hover:bg-slate-50"),children:[(0,t.jsx)("div",{className:"mt-0.5",children:a?(0,t.jsx)(j.CheckSquare,{className:"w-5 h-5 text-amber-600"}):(0,t.jsx)(N.Square,{className:"w-5 h-5 text-slate-400 group-hover:text-slate-600"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:(0,w.cn)("text-sm font-semibold mb-1",a?"text-amber-900":"text-slate-900"),children:e.name}),(0,t.jsx)("p",{className:"text-xs text-slate-600 leading-relaxed",children:e.description})]})]},e.slug)})})}),(0,t.jsxs)("div",{className:"p-6 border-t border-slate-200 bg-slate-50 flex justify-end gap-3",children:[(0,t.jsx)(l.Button,{variant:"ghost",onClick:n,className:"text-slate-700 hover:text-slate-900 hover:bg-slate-100",children:"Batal"}),(0,t.jsx)(l.Button,{variant:"gold",onClick:p,disabled:m||c,children:m?"Menyimpan...":"Simpan Perubahan"})]})]})})}function S(){let[e,d]=(0,a.useState)([]),[f,g]=(0,a.useState)([]),[b,j]=(0,a.useState)(!0),[N,w]=(0,a.useState)(!1),[k,S]=(0,a.useState)(null),[E,R]=(0,a.useState)(null),[M,P]=(0,a.useState)(null),T=(0,a.useRef)({}),A=(0,r.createClient)();async function B(){j(!0);try{let{data:e,error:t}=await A.from("profiles").select("*, roles(*)").order("created_at",{ascending:!1});t?console.error("Error fetching profiles:",t):d(e||[]);let{data:a,error:r}=await A.from("roles").select("id, name, slug, description").order("created_at",{ascending:!0});r?(console.error("Error fetching roles:",r),console.error("Role error details:",JSON.stringify(r,null,2)),g([])):(console.log("Roles fetched successfully:",a),g(a||[]))}catch(e){console.error("Error in fetchData:",e)}finally{j(!1)}}async function q(){let{data:e,error:t}=await A.from("roles").select("id, name, slug, description").order("created_at",{ascending:!0});return t?(console.error("Error fetching roles:",t),[]):e||[]}async function D(e){try{let{error:t}=await A.from("profiles").update({is_active:!e.is_active,updated_at:new Date().toISOString()}).eq("id",e.id);t?(console.error("Error toggling user status:",t),alert("Gagal mengubah status user: "+t.message)):(B(),P(null))}catch(e){console.error("Exception toggling user status:",e),alert("Terjadi kesalahan saat mengubah status user")}}async function I(e){if(confirm(`Apakah Anda yakin ingin menghapus user "${e.full_name}"?`))try{let{error:t}=await A.from("profiles").update({is_active:!1,updated_at:new Date().toISOString()}).eq("id",e.id);t?(console.error("Error deleting user:",t),alert("Gagal menghapus user: "+t.message)):(B(),P(null))}catch(e){console.error("Exception deleting user:",e),alert("Terjadi kesalahan saat menghapus user")}}return(0,a.useEffect)(()=>{B()},[]),(0,a.useEffect)(()=>{function e(e){Object.keys(T.current).forEach(t=>{let a=T.current[t];a&&!a.contains(e.target)&&P(null)})}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-display font-bold text-slate-900",children:"Manajemen User"}),(0,t.jsx)("p",{className:"text-slate-600 mt-1",children:"Kelola role dan izin akses semua pengguna e-Maktab"})]}),(0,t.jsxs)(l.Button,{variant:"gold",className:"gap-2",onClick:async()=>{0===f.length&&g(await q()),w(!0)},children:[(0,t.jsx)(n.UserPlus,{className:"w-4 h-4"}),(0,t.jsx)("span",{children:"User Baru"})]})]}),(0,t.jsxs)(s.Card,{className:"glass-card",children:[(0,t.jsxs)(s.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,t.jsxs)("div",{className:"relative w-full max-w-sm",children:[(0,t.jsx)(i.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"}),(0,t.jsx)("input",{type:"text",placeholder:"Cari nama, email, atau ID Santri...",className:"w-full bg-white border border-slate-300 rounded-lg py-2.5 pl-10 pr-4 text-sm focus:outline-none focus:border-emerald-600 focus:ring-2 focus:ring-emerald-600/20 text-slate-900 placeholder:text-slate-500 shadow-sm"})]}),(0,t.jsxs)(l.Button,{variant:"ghost",className:"gap-2 text-slate-700 hover:bg-slate-100 hover:text-slate-900",children:[(0,t.jsx)(o.Filter,{className:"w-4 h-4"}),(0,t.jsx)("span",{children:"Filter"})]})]}),(0,t.jsx)(s.CardContent,{className:"p-0",children:(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full text-left",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"border-b border-slate-200 bg-slate-50",children:[(0,t.jsx)("th",{className:"px-6 py-4 text-xs font-semibold text-slate-700 uppercase tracking-wider",children:"User"}),(0,t.jsx)("th",{className:"px-6 py-4 text-xs font-semibold text-slate-700 uppercase tracking-wider",children:"Role"}),(0,t.jsx)("th",{className:"px-6 py-4 text-xs font-semibold text-slate-700 uppercase tracking-wider",children:"Status"}),(0,t.jsx)("th",{className:"px-6 py-4 text-xs font-semibold text-slate-700 uppercase tracking-wider",children:"Santri ID"}),(0,t.jsx)("th",{className:"px-6 py-4 text-xs font-semibold text-slate-700 uppercase tracking-wider",children:"Tgl Dibuat"}),(0,t.jsx)("th",{className:"px-6 py-4 text-xs font-semibold text-slate-700 uppercase tracking-wider text-right",children:"Aksi"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-slate-100 bg-white",children:b?[1,2,3].map(e=>(0,t.jsx)("tr",{className:"animate-pulse",children:(0,t.jsx)("td",{colSpan:6,className:"px-6 py-8 text-center text-slate-500",children:"Memuat data..."})},e)):0===e.length?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:6,className:"px-6 py-12 text-center text-slate-500",children:"Belum ada user terdaftar."})}):e.map(e=>(0,t.jsxs)("tr",{className:`hover:bg-slate-50/80 transition-colors group ${!e.is_active?"opacity-60":""}`,children:[(0,t.jsx)("td",{className:"px-6 py-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:`w-10 h-10 rounded-full flex items-center justify-center font-semibold text-sm text-white shadow-sm ring-2 ${e.is_active?"bg-gradient-to-br from-emerald-600 to-emerald-700 ring-emerald-100":"bg-gradient-to-br from-slate-400 to-slate-500 ring-slate-200"}`,children:e.full_name?.charAt(0)||"?"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:e.full_name||"N/A"}),(0,t.jsxs)("p",{className:"text-xs text-slate-500 font-mono",children:[e.id.slice(0,8),"..."]})]})]})}),(0,t.jsx)("td",{className:"px-6 py-4",children:(0,t.jsx)("span",{className:_("inline-flex items-center text-xs font-semibold px-3 py-1.5 rounded-full border",e.roles?.slug==="superadmin"?"bg-emerald-100 text-emerald-800 border-emerald-200":e.roles?.slug==="operator"?"bg-amber-50 text-amber-700 border-amber-200":e.roles?.slug==="pengajar"?"bg-blue-50 text-blue-700 border-blue-200":e.roles?.slug==="santri"?"bg-slate-100 text-slate-700 border-slate-200":"bg-slate-50 text-slate-600 border-slate-200"),children:e.roles?.name||"Tidak ada role"})}),(0,t.jsx)("td",{className:"px-6 py-4",children:(0,t.jsx)("span",{className:_("inline-flex items-center text-xs font-semibold px-3 py-1.5 rounded-full border",e.is_active?"bg-green-50 text-green-700 border-green-200":"bg-red-50 text-red-700 border-red-200"),children:e.is_active?"Aktif":"Nonaktif"})}),(0,t.jsx)("td",{className:"px-6 py-4",children:(0,t.jsx)("span",{className:"text-sm font-mono text-slate-700",children:e.santri_id||(0,t.jsx)("span",{className:"text-slate-400",children:"-"})})}),(0,t.jsx)("td",{className:"px-6 py-4",children:(0,t.jsx)("span",{className:"text-xs text-slate-600",children:new Date(e.created_at).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"})})}),(0,t.jsx)("td",{className:"px-6 py-4 text-right",children:(0,t.jsxs)("div",{className:"flex justify-end gap-2 relative",children:[e.roles?.slug==="operator"&&(0,t.jsx)("button",{onClick:()=>{R(e),P(null)},className:"p-2 text-slate-600 hover:text-amber-600 transition-colors bg-white rounded-lg border border-slate-200 hover:border-amber-300 hover:bg-amber-50 shadow-sm",title:"Atur Hak Akses",children:(0,t.jsx)(u,{className:"w-4 h-4"})}),(0,t.jsxs)("div",{className:"relative",ref:t=>{T.current[e.id]=t},children:[(0,t.jsx)("button",{onClick:()=>P(M===e.id?null:e.id),className:"p-2 text-slate-600 hover:text-emerald-700 transition-colors bg-white rounded-lg border border-slate-200 hover:border-emerald-300 hover:bg-emerald-50 shadow-sm",children:(0,t.jsx)(c,{className:"w-4 h-4"})}),M===e.id&&(0,t.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-slate-200 z-10 overflow-hidden",children:[(0,t.jsxs)("button",{onClick:()=>{S(e),P(null)},className:"w-full px-4 py-2 text-left text-sm text-slate-700 hover:bg-slate-50 flex items-center gap-2",children:[(0,t.jsx)(m.Edit,{className:"w-4 h-4"}),"Edit User"]}),(0,t.jsx)("button",{onClick:()=>D(e),className:"w-full px-4 py-2 text-left text-sm text-slate-700 hover:bg-slate-50 flex items-center gap-2",children:e.is_active?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h,{className:"w-4 h-4"}),"Nonaktifkan"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x,{className:"w-4 h-4"}),"Aktifkan"]})}),(0,t.jsxs)("button",{onClick:()=>I(e),className:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center gap-2",children:[(0,t.jsx)(p.Trash2,{className:"w-4 h-4"}),"Hapus"]})]})]})]})})]},e.id))})]})})})]}),N&&(0,t.jsx)(y,{roles:f,onClose:()=>w(!1),onSuccess:B}),k&&(0,t.jsx)(v,{user:k,roles:f,onClose:()=>S(null),onSuccess:B}),E&&(0,t.jsx)(C,{user:E,onClose:()=>R(null),onSuccess:B})]})}function _(...e){return e.filter(Boolean).join(" ")}e.s(["default",()=>S],98134)}]);