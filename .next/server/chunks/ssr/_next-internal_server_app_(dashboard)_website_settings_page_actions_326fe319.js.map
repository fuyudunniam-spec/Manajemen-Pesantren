{"version":3,"sources":["../../../../src/lib/actions/website-settings.ts"],"sourcesContent":["'use server';\r\n\r\nimport { createClient } from '@/lib/supabase/server';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport interface WebsiteSettings {\r\n    site_title: string;\r\n    site_tagline: string;\r\n    site_description: string;\r\n    site_logo: string;\r\n    site_logo_small: string;\r\n    footer_text: string;\r\n    // Social media & contact (stored as JSON stringified values for flexibility)\r\n    social_links?: string; // JSON array\r\n    contact_whatsapp?: string;\r\n    contact_email?: string;\r\n    contact_phone?: string;\r\n    contact_address?: string;\r\n}\r\n\r\nexport async function getWebsiteSettings() {\r\n    const supabase = createClient();\r\n\r\n    const { data, error } = await supabase\r\n        .from('website_settings')\r\n        .select('*');\r\n\r\n    if (error) {\r\n        console.error('Error fetching settings:', error);\r\n        return {} as WebsiteSettings;\r\n    }\r\n\r\n    // Convert array of key-value pairs to object\r\n    const settings: any = {};\r\n    data?.forEach((item) => {\r\n        settings[item.key] = item.value;\r\n    });\r\n\r\n    return settings as WebsiteSettings;\r\n}\r\n\r\nexport async function updateWebsiteSettings(settings: Partial<WebsiteSettings>) {\r\n    const supabase = createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n\r\n    if (!user) {\r\n        throw new Error('Unauthorized');\r\n    }\r\n\r\n    // Convert object to array of key-value pairs for upsert\r\n    const updates = Object.entries(settings).map(([key, value]) => ({\r\n        key,\r\n        value: value || '',\r\n        updated_at: new Date().toISOString(),\r\n    }));\r\n\r\n    const { error } = await supabase\r\n        .from('website_settings')\r\n        .upsert(updates, { onConflict: 'key' });\r\n\r\n    if (error) {\r\n        throw new Error(error.message);\r\n    }\r\n\r\n    // Revalidate public pages\r\n    revalidatePath('/', 'layout');\r\n\r\n    return { success: true };\r\n}\r\n"],"names":[],"mappings":"wDAEA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAiBO,eAAe,IAClB,IAAM,EAAW,CAAA,EAAA,EAAA,YAAA,AAAY,IAEvB,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EACzB,IAAI,CAAC,oBACL,MAAM,CAAC,KAEZ,GAAI,EAEA,KAFO,EACP,QAAQ,KAAK,CAAC,2BAA4B,GACnC,CAAC,EAIZ,IAAM,EAAgB,CAAC,EAKvB,OAJA,GAAM,QAAS,AAAD,IACV,CAAQ,CAAC,EAAK,GAAG,CAAC,CAAG,EAAK,KAAK,AACnC,GAEO,CACX,CAEO,eAAe,EAAsB,CAAkC,EAC1E,IAAM,EAAW,CAAA,EAAA,EAAA,YAAA,AAAY,IAEvB,CAAE,KAAM,MAAE,CAAI,CAAE,CAAE,CAAG,MAAM,EAAS,IAAI,CAAC,OAAO,GAEtD,GAAI,CAAC,EACD,IADO,EACD,AAAI,MAAM,gBAIpB,IAAM,EAAU,OAAO,OAAO,CAAC,GAAU,GAAG,CAAC,CAAC,CAAC,EAAK,EAAM,GAAK,CAAC,CAC5D,MACA,MAAO,GAAS,GAChB,WAAY,IAAI,OAAO,WAAW,GACtC,CAAC,EAEK,OAAE,CAAK,CAAE,CAAG,MAAM,EACnB,IAAI,CAAC,oBACL,MAAM,CAAC,EAAS,CAAE,WAAY,KAAM,GAEzC,GAAI,EACA,KADO,CACD,AAAI,MAAM,EAAM,OAAO,EAMjC,MAFA,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,IAAK,UAEb,CAAE,SAAS,CAAK,CAC3B,0CAjDsB,EAqBA,IArBA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,MAqBA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA"}