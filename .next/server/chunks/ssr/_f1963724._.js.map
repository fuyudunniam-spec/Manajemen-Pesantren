{"version":3,"sources":["../../../../src/lib/actions/sections.ts","../../../../.next-internal/server/app/%28dashboard%29/website/builder/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["'use server';\r\n\r\nimport { createClient } from '@/lib/supabase/server';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport interface SectionData {\r\n    id?: string;\r\n    section_key: string;\r\n    page: string;\r\n    section_type: string;\r\n    title?: string;\r\n    subtitle?: string;\r\n    content: any; // JSON content\r\n    is_visible: boolean;\r\n    order_index: number;\r\n}\r\n\r\nexport async function getSections(page?: string) {\r\n    const supabase = createClient();\r\n\r\n    let query = supabase\r\n        .from('website_sections')\r\n        .select('*')\r\n        .order('order_index', { ascending: true });\r\n\r\n    if (page) {\r\n        query = query.eq('page', page);\r\n    }\r\n\r\n    const { data, error } = await query;\r\n\r\n    if (error) {\r\n        throw new Error(error.message);\r\n    }\r\n\r\n    return data;\r\n}\r\n\r\nexport async function getSectionById(id: string) {\r\n    const supabase = createClient();\r\n\r\n    const { data, error } = await supabase\r\n        .from('website_sections')\r\n        .select('*')\r\n        .eq('id', id)\r\n        .single();\r\n\r\n    if (error) {\r\n        throw new Error(error.message);\r\n    }\r\n\r\n    return data;\r\n}\r\n\r\nexport async function updateSection(id: string, section: Partial<SectionData>) {\r\n    const supabase = createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n\r\n    if (!user) {\r\n        throw new Error('Unauthorized');\r\n    }\r\n\r\n    const { error } = await supabase\r\n        .from('website_sections')\r\n        .update({\r\n            ...section,\r\n            updated_by: user.id,\r\n            updated_at: new Date().toISOString(),\r\n        })\r\n        .eq('id', id);\r\n\r\n    if (error) {\r\n        throw new Error(error.message);\r\n    }\r\n\r\n    revalidatePath('/dashboard/website/builder');\r\n    revalidatePath('/');\r\n\r\n    return { success: true };\r\n}\r\n\r\nexport async function createSection(section: SectionData) {\r\n    const supabase = createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n\r\n    if (!user) {\r\n        throw new Error('Unauthorized');\r\n    }\r\n\r\n    const { error } = await supabase\r\n        .from('website_sections')\r\n        .insert({\r\n            ...section,\r\n            updated_by: user.id,\r\n        });\r\n\r\n    if (error) {\r\n        throw new Error(error.message);\r\n    }\r\n\r\n    revalidatePath('/dashboard/website/builder');\r\n    revalidatePath('/');\r\n\r\n    return { success: true };\r\n}\r\n\r\nexport async function deleteSection(id: string) {\r\n    const supabase = createClient();\r\n\r\n    const { error } = await supabase\r\n        .from('website_sections')\r\n        .delete()\r\n        .eq('id', id);\r\n\r\n    if (error) {\r\n        throw new Error(error.message);\r\n    }\r\n\r\n    revalidatePath('/dashboard/website/builder');\r\n    revalidatePath('/');\r\n\r\n    return { success: true };\r\n}\r\n\r\nexport async function duplicateSection(id: string) {\r\n    const supabase = createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n\r\n    if (!user) {\r\n        throw new Error('Unauthorized');\r\n    }\r\n\r\n    // Get original section\r\n    const { data: original, error: fetchError } = await supabase\r\n        .from('website_sections')\r\n        .select('*')\r\n        .eq('id', id)\r\n        .single();\r\n\r\n    if (fetchError) {\r\n        throw new Error(fetchError.message);\r\n    }\r\n\r\n    // Create duplicate with new key\r\n    const { error: insertError } = await supabase\r\n        .from('website_sections')\r\n        .insert({\r\n            section_key: `${original.section_key}_copy_${Date.now()}`,\r\n            page: original.page,\r\n            section_type: original.section_type,\r\n            title: `${original.title} (Copy)`,\r\n            subtitle: original.subtitle,\r\n            content: original.content,\r\n            is_visible: false, // Start as hidden\r\n            order_index: original.order_index + 1,\r\n            updated_by: user.id,\r\n        });\r\n\r\n    if (insertError) {\r\n        throw new Error(insertError.message);\r\n    }\r\n\r\n    revalidatePath('/dashboard/website/builder');\r\n\r\n    return { success: true };\r\n}\r\n\r\nexport async function toggleSectionVisibility(id: string, currentStatus: boolean) {\r\n    const supabase = createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n\r\n    if (!user) {\r\n        throw new Error('Unauthorized');\r\n    }\r\n\r\n    const { error } = await supabase\r\n        .from('website_sections')\r\n        .update({\r\n            is_visible: !currentStatus,\r\n            updated_by: user.id,\r\n            updated_at: new Date().toISOString(),\r\n        })\r\n        .eq('id', id);\r\n\r\n    if (error) {\r\n        throw new Error(error.message);\r\n    }\r\n\r\n    revalidatePath('/dashboard/website/builder');\r\n    revalidatePath('/');\r\n\r\n    return { success: true, newStatus: !currentStatus };\r\n}\r\n\r\nexport async function reorderSections(sections: { id: string; order_index: number }[]) {\r\n    const supabase = createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n\r\n    if (!user) {\r\n        throw new Error('Unauthorized');\r\n    }\r\n\r\n    // Update all sections in a transaction-like manner\r\n    const updates = sections.map((section) =>\r\n        supabase\r\n            .from('website_sections')\r\n            .update({\r\n                order_index: section.order_index,\r\n                updated_by: user.id,\r\n                updated_at: new Date().toISOString(),\r\n            })\r\n            .eq('id', section.id)\r\n    );\r\n\r\n    await Promise.all(updates);\r\n\r\n    revalidatePath('/dashboard/website/builder');\r\n    revalidatePath('/');\r\n\r\n    return { success: true };\r\n}\r\n","export {getSections as '40c83ab34517a0288c8210addee654fd2d166e271f'} from 'ACTIONS_MODULE0'\nexport {deleteSection as '40350dfa6ee98d66f2b66eff338731db7a131ff068'} from 'ACTIONS_MODULE0'\nexport {duplicateSection as '4065dbfb8302a4eb10d11eb4a3059fdabb0b71025f'} from 'ACTIONS_MODULE0'\nexport {toggleSectionVisibility as '606bcb8e46f4457ea74cb08a402f66f2478daa8b4b'} from 'ACTIONS_MODULE0'\nexport {reorderSections as '40559c3b7beb0c2b585effe228b50930f473c7a9bf'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":"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"}