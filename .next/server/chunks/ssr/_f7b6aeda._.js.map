{"version":3,"sources":["../../../../src/lib/actions/pages.ts","../../../../.next-internal/server/app/%28dashboard%29/website/pages/%5Bid%5D/edit/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["'use server';\r\n\r\nimport { createClient } from '@/lib/supabase/server';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport interface PageData {\r\n    id?: string;\r\n    slug: string;\r\n    title: string;\r\n    content: string;\r\n    meta_description?: string;\r\n    hero_image?: string;\r\n    is_published: boolean;\r\n    show_in_nav: boolean;\r\n    nav_label?: string;\r\n    nav_order?: number;\r\n}\r\n\r\nexport async function getPages() {\r\n    const supabase = createClient();\r\n\r\n    const { data, error } = await supabase\r\n        .from('website_pages')\r\n        .select('*')\r\n        .order('updated_at', { ascending: false });\r\n\r\n    if (error) {\r\n        throw new Error(error.message);\r\n    }\r\n\r\n    return data;\r\n}\r\n\r\nexport async function getPageBySlug(slug: string, preview = false) {\r\n    const supabase = createClient();\r\n\r\n    let query = supabase\r\n        .from('website_pages')\r\n        .select('*')\r\n        .eq('slug', slug);\r\n\r\n    // Only show published in non-preview mode\r\n    if (!preview) {\r\n        query = query.eq('is_published', true);\r\n    }\r\n\r\n    const { data, error } = await query.single();\r\n\r\n    if (error) {\r\n        return null;\r\n    }\r\n\r\n    return data;\r\n}\r\n\r\nexport async function getPageById(id: string) {\r\n    const supabase = createClient();\r\n\r\n    const { data, error } = await supabase\r\n        .from('website_pages')\r\n        .select('*')\r\n        .eq('id', id)\r\n        .single();\r\n\r\n    if (error) {\r\n        throw new Error(error.message);\r\n    }\r\n\r\n    return data;\r\n}\r\n\r\nexport async function createPage(page: PageData) {\r\n    const supabase = createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n\r\n    if (!user) {\r\n        throw new Error('Unauthorized');\r\n    }\r\n\r\n    const { error } = await supabase\r\n        .from('website_pages')\r\n        .insert({\r\n            ...page,\r\n            created_by: user.id,\r\n            updated_by: user.id,\r\n        });\r\n\r\n    if (error) {\r\n        throw new Error(error.message);\r\n    }\r\n\r\n    revalidatePath('/dashboard/website/pages');\r\n    revalidatePath(`/${page.slug}`);\r\n\r\n    return { success: true };\r\n}\r\n\r\nexport async function updatePage(id: string, page: Partial<PageData>) {\r\n    const supabase = createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n\r\n    if (!user) {\r\n        throw new Error('Unauthorized');\r\n    }\r\n\r\n    const { error } = await supabase\r\n        .from('website_pages')\r\n        .update({\r\n            ...page,\r\n            updated_by: user.id,\r\n            updated_at: new Date().toISOString(),\r\n        })\r\n        .eq('id', id);\r\n\r\n    if (error) {\r\n        throw new Error(error.message);\r\n    }\r\n\r\n    revalidatePath('/dashboard/website/pages');\r\n    if (page.slug) {\r\n        revalidatePath(`/${page.slug}`);\r\n    }\r\n\r\n    return { success: true };\r\n}\r\n\r\nexport async function deletePage(id: string) {\r\n    const supabase = createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n\r\n    if (!user) {\r\n        throw new Error('Unauthorized');\r\n    }\r\n\r\n    const { error } = await supabase\r\n        .from('website_pages')\r\n        .delete()\r\n        .eq('id', id);\r\n\r\n    if (error) {\r\n        throw new Error(error.message);\r\n    }\r\n\r\n    revalidatePath('/dashboard/website/pages');\r\n\r\n    return { success: true };\r\n}\r\n\r\nexport async function togglePublish(id: string, currentStatus: boolean) {\r\n    const supabase = createClient();\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n\r\n    if (!user) {\r\n        throw new Error('Unauthorized');\r\n    }\r\n\r\n    const { error } = await supabase\r\n        .from('website_pages')\r\n        .update({\r\n            is_published: !currentStatus,\r\n            updated_by: user.id,\r\n            updated_at: new Date().toISOString(),\r\n        })\r\n        .eq('id', id);\r\n\r\n    if (error) {\r\n        throw new Error(error.message);\r\n    }\r\n\r\n    revalidatePath('/dashboard/website/pages');\r\n\r\n    return { success: true, newStatus: !currentStatus };\r\n}\r\n","export {getPageById as '401dc94dd5dc51e271ddeff3f44d3d738533493154'} from 'ACTIONS_MODULE0'\nexport {createPage as '4075e9d5cee05d3c49b224a67708f3beb900904deb'} from 'ACTIONS_MODULE0'\nexport {updatePage as '6036857a822aee89d791ca2621eacd0daed3be04c2'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":"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"}