{"version":3,"sources":["../../../../src/lib/actions/categories.ts","../../../../.next-internal/server/app/%28dashboard%29/website/categories/%5Bid%5D/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["\"use server\";\r\n\r\nimport { createClient } from \"@/lib/supabase/server\";\r\nimport { revalidatePath } from \"next/cache\";\r\nimport { generateSlug } from \"@/lib/blog-utils\";\r\n\r\nexport interface BlogCategory {\r\n    id: string;\r\n    name: string;\r\n    slug: string;\r\n    description?: string;\r\n    color: string;\r\n    icon?: string;\r\n    display_order: number;\r\n    is_active: boolean;\r\n    created_at: string;\r\n    updated_at: string;\r\n}\r\n\r\nexport async function getCategories(includeInactive = false) {\r\n    const supabase = createClient();\r\n\r\n    let query = supabase\r\n        .from(\"blog_categories\")\r\n        .select(\"*\")\r\n        .order(\"display_order\", { ascending: true });\r\n\r\n    if (!includeInactive) {\r\n        query = query.eq(\"is_active\", true);\r\n    }\r\n\r\n    const { data, error } = await query;\r\n\r\n    if (error) {\r\n        console.error(\"Error fetching categories:\", error);\r\n        return [];\r\n    }\r\n\r\n    return data as BlogCategory[];\r\n}\r\n\r\nexport async function getCategory(slug: string) {\r\n    const supabase = createClient();\r\n\r\n    const { data, error } = await supabase\r\n        .from(\"blog_categories\")\r\n        .select(\"*\")\r\n        .eq(\"slug\", slug)\r\n        .single();\r\n\r\n    if (error) {\r\n        console.error(\"Error fetching category:\", error);\r\n        return null;\r\n    }\r\n\r\n    return data as BlogCategory;\r\n}\r\n\r\nexport async function createCategory(formData: FormData) {\r\n    const supabase = createClient();\r\n\r\n    const name = formData.get(\"name\") as string;\r\n    const slug = formData.get(\"slug\") as string;\r\n    const description = formData.get(\"description\") as string;\r\n    const color = formData.get(\"color\") as string;\r\n    const icon = formData.get(\"icon\") as string;\r\n    const display_order = parseInt(formData.get(\"display_order\") as string) || 0;\r\n\r\n    const { data, error } = await supabase\r\n        .from(\"blog_categories\")\r\n        .insert({\r\n            name,\r\n            slug,\r\n            description,\r\n            color,\r\n            icon,\r\n            display_order,\r\n            is_active: true,\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n    if (error) {\r\n        console.error(\"Error creating category:\", error);\r\n        throw new Error(error.message);\r\n    }\r\n\r\n    revalidatePath(\"/dashboard/website/categories\");\r\n    revalidatePath(\"/berita\");\r\n    return data;\r\n}\r\n\r\nexport async function updateCategory(id: string, formData: FormData) {\r\n    const supabase = createClient();\r\n\r\n    const name = formData.get(\"name\") as string;\r\n    const slug = formData.get(\"slug\") as string;\r\n    const description = formData.get(\"description\") as string;\r\n    const color = formData.get(\"color\") as string;\r\n    const icon = formData.get(\"icon\") as string;\r\n    const display_order = parseInt(formData.get(\"display_order\") as string) || 0;\r\n    const is_active = formData.get(\"is_active\") === \"true\";\r\n\r\n    const { data, error } = await supabase\r\n        .from(\"blog_categories\")\r\n        .update({\r\n            name,\r\n            slug,\r\n            description,\r\n            color,\r\n            icon,\r\n            display_order,\r\n            is_active,\r\n            updated_at: new Date().toISOString(),\r\n        })\r\n        .eq(\"id\", id)\r\n        .select()\r\n        .single();\r\n\r\n    if (error) {\r\n        console.error(\"Error updating category:\", error);\r\n        throw new Error(error.message);\r\n    }\r\n\r\n    revalidatePath(\"/dashboard/website/categories\");\r\n    revalidatePath(\"/berita\");\r\n    return data;\r\n}\r\n\r\nexport async function deleteCategory(id: string) {\r\n    const supabase = createClient();\r\n\r\n    // Check if category has posts\r\n    const { count } = await supabase\r\n        .from(\"blog_posts\")\r\n        .select(\"*\", { count: \"exact\", head: true })\r\n        .eq(\"category_id\", id);\r\n\r\n    if (count && count > 0) {\r\n        throw new Error(\"Cannot delete category with existing posts\");\r\n    }\r\n\r\n    const { error } = await supabase\r\n        .from(\"blog_categories\")\r\n        .delete()\r\n        .eq(\"id\", id);\r\n\r\n    if (error) {\r\n        console.error(\"Error deleting category:\", error);\r\n        throw new Error(error.message);\r\n    }\r\n\r\n    revalidatePath(\"/dashboard/website/categories\");\r\n    revalidatePath(\"/berita\");\r\n}\r\n\r\nexport async function toggleCategoryStatus(id: string, isActive: boolean) {\r\n    const supabase = createClient();\r\n\r\n    const { error } = await supabase\r\n        .from(\"blog_categories\")\r\n        .update({ is_active: isActive, updated_at: new Date().toISOString() })\r\n        .eq(\"id\", id);\r\n\r\n    if (error) {\r\n        console.error(\"Error toggling category status:\", error);\r\n        throw new Error(error.message);\r\n    }\r\n\r\n    revalidatePath(\"/dashboard/website/categories\");\r\n    revalidatePath(\"/berita\");\r\n}\r\n","export {createCategory as '409fea0b7d826303caf40d9bddc8e9e90cd3082694'} from 'ACTIONS_MODULE0'\nexport {updateCategory as '605580fa537660835c94d950b0d3a92f6c38da6c8a'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":"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"}